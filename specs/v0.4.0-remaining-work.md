# Remote.py v0.4.0 Remaining Work

Work through the issues described in this document.
Once an issue has been resolved, run the tests, atomic commit and push to the branch.
Update this spec after each issue.

## Remaining Work for v0.4.0

### Critical Bugs

#### 1. Fix `read_config()` Parameter Bug
**GitHub Issue:** Part of #51
**File:** `remotepy/config.py`
**Status:** COMPLETED

**Problem:**
```python
def read_config(config_path):
    cfg = configparser.ConfigParser()
    cfg.read(CONFIG_PATH)  # BUG: Uses global CONFIG_PATH, ignores parameter
    return cfg
```

**Solution:** Change `CONFIG_PATH` to `config_path`.

**Acceptance Criteria:**
- [x] `read_config()` uses the provided parameter
- [x] Test added to verify custom config paths work

---

#### 2. Fix `create-snapshot` Input Validation (#15)
**GitHub Issue:** #15
**File:** `remotepy/snapshot.py`
**Status:** COMPLETED

**Problem:** `create-snapshot` crashes with ParamValidationError when called without required options.

**Solution:** Add input validation before calling AWS API:
```python
def create(
    volume_id: str = typer.Option(..., help="Volume ID"),  # Make required
    name: str = typer.Option(..., help="Snapshot name"),   # Make required
    description: str = typer.Option("", help="Description"),
):
```

Or validate and prompt for missing values.

**Acceptance Criteria:**
- [x] Command provides helpful error if required options missing
- [x] No unhandled exceptions from AWS SDK

---

### Security Improvements

#### 3. Fix SSH Host Key Verification (#54)
**GitHub Issue:** Part of #54
**File:** `remotepy/instance.py:279`
**Status:** COMPLETED

**Problem:**
```python
"StrictHostKeyChecking=no",  # Vulnerable to MITM attacks
```

**Solution:** Change to `StrictHostKeyChecking=accept-new`:
- Accepts new host keys automatically (convenience)
- Rejects changed keys (security against MITM)

**Acceptance Criteria:**
- [x] Default uses `accept-new`
- [x] Optional `--no-strict-host-key` flag for legacy behavior

---

### Code Quality

#### 4. Add Comprehensive Type Hints (#52)
**GitHub Issue:** #52
**Status:** Partially done

**Remaining work:**
- [ ] Add mypy configuration to pyproject.toml
- [ ] Run `mypy --strict` and fix issues
- [ ] Add mypy to CI pipeline

---

#### 5. Implement AWS API Pagination
**Status:** Not started

**Problem:** List operations don't handle >100 items.

**Solution:** Use boto3 paginators for:
- `get_instances()` in utils.py
- `get_all_clusters()` in ecs.py
- `get_all_services()` in ecs.py

---

### Architecture

#### 6. Dependency Injection for AWS Clients (#53)
**GitHub Issue:** #53
**Status:** Not started

**Problem:** Module-level boto3 clients make testing harder and prevent lazy initialization.

**Solution:**
```python
from functools import lru_cache

@lru_cache
def get_ec2_client():
    return boto3.client("ec2")
```

---

#### 7. Configuration Management (#51)
**GitHub Issue:** #51
**Status:** Partially done (read_config bug FIXED)

Additional work:
- [x] Fix read_config parameter bug
- [ ] Consider using pydantic for config validation
- [ ] Support environment variable overrides

---

### Distribution

#### 8. Upload to PyPI (#18)
**GitHub Issue:** #18
**Status:** CI exists, needs manual trigger

**Remaining work:**
- [ ] Verify publish.yml workflow works
- [ ] Set up PyPI API token in GitHub secrets
- [ ] Create initial release on PyPI
- [ ] Update README with `pip install remotepy`

---

#### 9. Document pipx Installation (#31)
**GitHub Issue:** #31
**Status:** Documentation exists

**Remaining work:**
- [ ] Verify pipx install works after PyPI upload
- [ ] Add pipx to README as primary method

---

### Enhancements

#### 10. Add Instance Pricing (#32)
**GitHub Issue:** #32
**Status:** Not started

**Description:** Show instance pricing in `remote list` output.

**Complexity:** Medium - requires AWS Pricing API integration.

---

#### 11. Rename Package to `remote` (#26)
**GitHub Issue:** #26
**Status:** Not started

**Current:** Package folder is `remotepy`
**Target:** Rename to `remote`

**Considerations:**
- Breaking change for existing users
- May conflict with other packages
- Requires updating all imports

**Decision:** Defer to v1.0.0 or leave as-is.

---

### Documentation

#### 12. Development Instructions (#25)
**GitHub Issue:** #25
**Status:** Mostly done

**Remaining:**
- [ ] Verify editable install instructions work with uv
- [ ] Add contributing guide

---

## Implementation Priority

### High Priority (v0.4.0)
1. ~~Fix `read_config()` parameter bug (#51)~~ DONE
2. ~~Fix `create-snapshot` input validation (#15)~~ DONE
3. ~~Fix SSH StrictHostKeyChecking (#54)~~ DONE
4. Upload to PyPI (#18)

### Medium Priority (v0.4.x)
5. Add comprehensive type hints + mypy (#52)
6. Implement AWS API pagination
7. Dependency injection for clients (#53)

### Low Priority (v0.5.0+)
8. Add instance pricing (#32)
9. Rename package to `remote` (#26)

---

## GitHub Issue Summary

| Issue | Title | Status | Target |
|-------|-------|--------|--------|
| #54 | Security practices | **Partial** (SSH fixed) | v0.4.0 |
| #53 | Dependency injection | Open | v0.4.x |
| #52 | Type hints | Open | v0.4.x |
| #51 | Configuration management | **Partial** (read_config fixed) | v0.4.0 |
| #32 | Add price | Open | v0.5.0 |
| #31 | Install with pipx | Open | v0.4.0 |
| #26 | Rename source folder | Open | v1.0.0 |
| #25 | Development instructions | Open | v0.4.0 |
| #18 | Upload to PyPi | Open | v0.4.0 |
| #15 | create-snapshot errors | **CLOSED** | v0.4.0 |
| #49 | Duplicate functions | **Close** | - |
| #50 | Error handling | **Close** | - |
| #24 | GitHub action tests | **Close** | - |
| #6 | Error if no credentials | **Close** | - |
| #1 | Initial functionality | **Close** | - |
